<div class="section-container" style="min-width: 80%;">
    <div class="section-container-header">
        <h2>Admin Dashboard</h2>
    </div>
    <div class="section-container-body">
        <div id="admin-tabs" data-controller="admin-tabs" style="width: 100%;">
            <div class="admin-tab-header-flex" style="display: flex; align-items: center; justify-content: space-between; gap: 1em; max-height: 70vh;">
                <div class="admin-tab-buttons" style="display: flex; gap: 0.5em;">
                    <button type="button" class="admin-tab-btn active" data-admin-tabs-target="tabBtn" data-tab="users" data-action="click->admin-tabs#switch">Users</button>
                    <button type="button" class="admin-tab-btn" data-admin-tabs-target="tabBtn" data-tab="articles" data-action="click->admin-tabs#switch">Articles</button>
                </div>
                <div class="search-bar-container" style="flex-grow: 1; max-width: 80%;">
                    <%= text_field_tag :admin_query, params[:admin_query],
                        placeholder: "Search users, articles, authors...",
                        class: "search-input",
                        data: { action: "input->admin-tabs#search", admin_tabs_target: "searchInput" }
                    %>
                </div>
            </div>
            <div class="admin-tab-content" id="users-tab" data-admin-tabs-target="tabContent" style="display: block;">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Picture</th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="user-id"><span>User Id</span><span class="sort-arrow" data-admin-tabs-target="userIdArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="username"><span>Username</span><span class="sort-arrow" data-admin-tabs-target="usernameArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="first-name"><span>First Name</span><span class="sort-arrow" data-admin-tabs-target="firstNameArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="last-name"><span>Last Name</span><span class="sort-arrow" data-admin-tabs-target="lastNameArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="created-at"><span>Created At</span><span class="sort-arrow" data-admin-tabs-target="createdAtArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="updated-at"><span>Updated At</span><span class="sort-arrow" data-admin-tabs-target="updatedAtArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="encrypted-password"><span>Encrypted Password</span><span class="sort-arrow" data-admin-tabs-target="encryptedPasswordArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="role"><span>Role</span><span class="sort-arrow" data-admin-tabs-target="roleArrow"></span></th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% User.all.each do |user| %>
                            <tr>
                                <td>
                                    <% if user.profile_picture.attached? %>
                                        <%= image_tag user.profile_picture, class: "profile-pic-small" %>
                                    <% else %>
                                        <span class="material-symbols-rounded default-user-icon">account_circle</span>
                                    <% end %>
                                </td>
                                <td><%= user.id %></td>
                                <td><%= link_to user.username, user_path(user) %></td>
                                <td><%= user.first_name %></td>
                                <td><%= user.last_name %></td>
                                <td><%= user.created_at %></td>
                                <td><%= user.updated_at %></td>
                                <td><%= user.encrypted_password.present? ? "Set" : "Unset" %></td>
                                <td><%= user.admin? ? "Admin" : "User" %></td>
                                <td>
                                    <%= link_to 'Delete', user_path(user), method: :delete, data: { confirm: 'Are you sure you want to delete this user?' }, class: 'btn btn-sm btn-danger' %>
                                </td>
                            </tr>
                        <% end %>
                    </tbody>
                </table>
            </div>
            <div class="admin-tab-content" id="articles-tab" data-admin-tabs-target="tabContent" style="display: none;">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="article-id"><span>Article Id</span><span class="sort-arrow" data-admin-tabs-target="articleIdArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="title"><span>Title</span><span class="sort-arrow" data-admin-tabs-target="titleArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="author"><span>Author</span><span class="sort-arrow" data-admin-tabs-target="authorArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="created-at"><span>Created At</span><span class="sort-arrow" data-admin-tabs-target="createdAtArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="updated-at"><span>Updated At</span><span class="sort-arrow" data-admin-tabs-target="updatedAtArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="comments"><span>Comments</span><span class="sort-arrow" data-admin-tabs-target="commentsArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="photos"><span>Photos</span><span class="sort-arrow" data-admin-tabs-target="photosArrow"></span></th>
                            <th data-action="click->admin-tabs#sort" data-admin-tabs-column="likes"><span>Likes</span><span class="sort-arrow" data-admin-tabs-target="likesArrow"></span></th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% Article.all.each do |article| %>
                            <tr>
                                <td><%= article.id %></td>
                                <td><%= link_to article.title, article_path(article) %></td>
                                <td><%= link_to article.user.username, user_path(article.user) %></td>
                                <td><%= article.created_at %></td>
                                <td><%= article.updated_at %></td>
                                <td><%= article.comments.count %></td>
                                <td><%= article.photos.attached? ? article.photos.count : 0 %></td>
                                <td><%= article.article_likes.count %></td>
                                <td>
                                  <%= link_to 'Edit', edit_article_path(article), class: 'btn btn-sm btn-primary', style: 'margin-right: 0.5em;' %>
                                  <%= link_to 'Delete', article_path(article), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-sm btn-danger' %>
                                </td>
                            </tr>
                        <% end %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
