<% content_for(:title, "Narratree - #{ @article.title }") %>
<div class="article-page">
  <div class="article-btn-container">
    <% if current_user %>
      <% if current_user.saved_articles.exists?(article_id: @article.id) %>
        <%= button_to toggle_save_article_path(@article), method: :post, class: "user-interaction-btn" do %>
          <span class="material-symbols-rounded filled">bookmark</span>
        <% end %>
      <% else %>
        <%= button_to toggle_save_article_path(@article), method: :post, class: "user-interaction-btn" do %>
          <span class="material-symbols-rounded">bookmark</span>
        <% end %>
      <% end %>
      <% if @article.users.include?(current_user) %>
        <%= button_to unlike_article_path(@article), class: "user-interaction-btn", method: :post do %>
          <span class="material-symbols-rounded filled">thumb_up</span>
          <span class="like-count"><%= @article.users.count %></span>
        <% end %>
      <% else %>
        <%= button_to like_article_path(@article), class: "user-interaction-btn", method: :post do %>
          <span class="material-symbols-rounded">thumb_up</span>
          <span class="like-count"><%= @article.users.count %></span>
        <% end %>
      <% end %>
      <%= button_to "#", class: "user-interaction-btn", title: "Share Article" do %>
        <span class="material-symbols-rounded">share</span>
      <% end %>

      <% if @article.user == current_user %>
        <%= link_to edit_article_path(@article), class: "user-interaction-btn", title: "Edit Article" do %>
          <span class="material-symbols-rounded">edit</span>
        <% end %>
        <%= link_to article_path(@article), class: "user-interaction-btn article-delete-btn", title: "Delete Article", data: {
          turbo_method: :delete, turbo_confirm: "Are you sure?" } do %>
          <span class="material-symbols-rounded">delete</span>
        <% end %>
      <% end %>
    <% else %>
      <%= button_to like_article_path(@article), class: "user-interaction-btn", disabled: true, method: :post do %>
          <span class="material-symbols-rounded">thumb_up</span>
          <span class="like-count"><%= @article.users.count %></span>
      <% end %>
      <%= button_to "#", class: "user-interaction-btn", title: "Share Article" do %>
        <span class="material-symbols-rounded">share</span>
      <% end %>
    <% end %>
  </div>
  
  <div id="article-top">
    <h1 class="article-page-title">
      <%= @article.title %>
    </h1>
    <p class="article-page-author">
      <em>by <%= @article.user&.username %> on <%= @article.created_at.strftime("%B %d, %Y") %></em>
    </p>
  </div>
  
  <!-- Uncomment this section to enable the carousel>
  <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img class="d-block w-100 carousel-image" src="https://512pixels.net/wp-content/uploads/2025/06/26-Tahoe-Light-6K-thumb.jpeg" alt="First slide">
      </div>
      <div class="carousel-item">
        <img class="d-block w-100 carousel-image" src="https://512pixels.net/wp-content/uploads/2025/08/26-Tahoe-Beach-Day-thumb.jpeg" alt="Second slide">
      </div>
      <div class="carousel-item">
        <img class="d-block w-100 carousel-image" src="https://512pixels.net/downloads/macos-wallpapers-6k/15-Sequoia-Sunrise.png" alt="Third slide">
      </div>
    </div>
    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
  -->

  <div class="article-body">
    <p><%= @article.body %></p>
  </div>
  
  <div class="comments-section" id="comments-section">
    <% if current_user %>
      <%= render "comments/form", article: @article, comment: @comment %>
    <% end %>
    <%= render @article.comments.where(parent_id: nil).order(created_at: :desc) %>
  </div>
</div>
