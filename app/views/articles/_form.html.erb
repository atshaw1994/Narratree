<div class="form">
  <%= form_with model: article do |form| %>
    <div class>
    <div class="form-group">
      <%= form.label :title %><br>
      <%= form.text_field :title, class: "form-input-field" %>
      <% article.errors.full_messages_for(:title).each do |message| %>
        <div><%= message %></div>
      <% end %>
    </div>
    <div class="form-group">
      <%= form.label :body %><br>
      <%= form.text_area :body, class: "article-body-field" %><br>
      <% article.errors.full_messages_for(:body).each do |message| %>
        <div><%= message %></div>
      <% end %>
    </div>
    <div class="form-group" id="photo-upload-group" data-controller="photo-upload">
      <button type="button" id="photo-upload-btn" class="user-interaction-btn" style="width: 64px; height: 64px;" data-action="click->photo-upload#openDialog">
        <span class="material-symbols-rounded">add_photo_alternate</span>
      </button>
      <%= form.file_field :photos, multiple: true, accept: 'image/*', style: 'display:none;', id: 'photo-upload-input', data: { photo_upload_target: "input", action: "change->photo-upload#filesChanged" } %>
      <!-- Only show previews for newly selected files -->
      <div data-photo-upload-target="preview" style="display:inline-flex;gap:8px;vertical-align:middle;"></div>
      <!-- Show already attached photos separately -->
      <% if article.persisted? && article.photos.attached? %>
        <div class="attached-photo-previews" style="display:inline-flex;gap:8px;vertical-align:middle;margin-top:8px;">
          <% article.photos.each_with_index do |photo, idx| %>
            <div style="position:relative;width:64px;height:64px;display:inline-block;">
              <%= image_tag photo.variant(resize_to_limit: [64, 64]), style: "width:64px;height:64px;object-fit:cover;border-radius:4px;" %>
              <%= button_to remove_photo_article_path(article, photo.id), method: :delete, form: { data: { turbo_confirm: 'Remove this photo?' } }, class: "remove-photo-btn", style: "position:absolute;top:-8px;right:-8px;width:20px;height:20px;background:red;color:white;border:none;border-radius:50%;font-size:14px;display:flex;align-items:center;justify-content:center;cursor:pointer;" do %>
                âœ•
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
      <% article.errors.full_messages_for(:photos).each do |message| %>
        <div><%= message %></div>
      <% end %>
    </div>
    <div class="form-submit-section">
      <%= button_to article, class: "form-submit-button" do %>Cancel<% end %>
      <%= form.submit class: "form-submit-button" %>
    </div>
  <% end %>
</div>
