<div class="header">
  <div class="header-left">
    <img src="<%= asset_path('logo.png') %>" alt="Logo" class="logo">
    <h1 class="page-title">Narratree</h1>
  </div>
  <div class="header-btns">
    <%= link_to root_path, class: "header-btn" do %>
        <span class="material-symbols-rounded">home</span>
    <% end %>
    <%= link_to about_path, class: "header-btn" do %>
        <span class="material-symbols-rounded">info</span>
    <% end %>
    <button id="theme-toggle" aria-label="Toggle theme mode" class="header-btn" data-controller="theme-controller" data-action="click->theme-controller#toggle">
      <span class="material-symbols-rounded">brightness_7</span>
    </button>
    <% if user_signed_in? %>
      <div class="dropdown-menu-container">
        <button class="header-btn dropdown-trigger">
          <% if current_user.profile_picture.attached? %>
            <%= image_tag current_user.profile_picture, class: "profile-pic-small" %>
          <% else %>
            <span class="material-symbols-rounded">account_circle</span>
          <% end %>
          <span><%= current_user.username %></span>
        </button>
        <div class="dropdown-menu">
          <%= link_to "Profile", user_path(current_user), class: "dropdown-item" %>
          <%= link_to "Log Out", destroy_user_session_path, data: { turbo_method: :delete }, class: "dropdown-item" %>
        </div>
      </div>
    <% else %>
      <%= link_to new_user_session_path, onclick: "showModal(event); return false;", class: "header-btn" do %>
        <span class="material-symbols-rounded">account_circle</span>
        <span><em>Not Signed In</em></span>
      <% end %>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dropdownTrigger = document.querySelector('.dropdown-trigger');
    const dropdownMenu = document.querySelector('.dropdown-menu');

    if (dropdownTrigger && dropdownMenu) {
      dropdownTrigger.addEventListener('click', (event) => {
        event.preventDefault();
        dropdownMenu.classList.toggle('visible');
      });

      // Close the dropdown if the user clicks outside of it
      document.addEventListener('click', (event) => {
        if (!dropdownTrigger.contains(event.target) && !dropdownMenu.contains(event.target)) {
          dropdownMenu.classList.remove('visible');
        }
      });
    }
  });
</script>